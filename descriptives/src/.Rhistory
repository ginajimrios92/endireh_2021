#
# Author: Georgina Jimenez
# -----------------------------------------------------------
# endireh2021/output/graficas
#### Paquetería ####
if(!require(pacman)) install.packages("pacman")
pacman::p_load(tidyverse, here, ggplot2, ggalt)
options(scipen=999)
files <- list(endireh11 = here("import-clean/output/endireh2011.rds"),
endireh16 = here("import-clean/output/endireh2016.rds"),
endireh21 = here("import-clean/output/endireh2021.rds"),
pob = here("import-clean/output/pob.rds"))
source(here("descriptives/src/theme.R"))
suma <- function(x) {
x <- ifelse(x>0, 1, 2)
}
sino <- function(x){
x <- case_when(x==1 ~ "Sí",
x==2 ~ "No")
}
#### Gráfica de familia de origen ####
endireh16 <- readRDS(files$endireh16)
endireh21 <- readRDS(files$endireh21)%>%
filter(veinteomas==1)
data <- bind_rows(endireh16, endireh21)%>%
mutate(viosexinf=rowSums(.[,41:46], na.rm=T),
viosexinf=sino(suma(viosexinf)))
strat_design_survey <- svydesign(~1, strata = ~est_dis, fpc = ~fpc,
weight = ~fac_muj, data = data)
p_load(srvyr)
strat_design_survey <- svydesign(~1, strata = ~est_dis,
weight = ~fac_muj, data = data)
p_load(srvyr)
strat_design_survey <- svydesign(~1, strata = ~est_dis,
weight = ~fac_muj, data = data)
p_load(tidyverse)
strat_design_survey <- svydesign(~1, strata = ~est_dis,
weight = ~fac_muj, data = data)
p_load(survey)
strat_design_survey <- svydesign(~1, strata = ~est_dis,
weight = ~fac_muj, data = data)
svytable(~viofisinf, data)
svytable(~viofisinf, encuesta)
encuesta <- svydesign(~1, strata = ~est_dis,
weight = ~fac_muj, data = data)
svytable(~viofisinf, encuesta)
prop.table(svytable((~viofisinf,data), margin=1)
prop.table(svytable((~viofisinf, data), margin=1))
prop.table(svytable((~viofisinf), data), margin=1)
prop.table(svytable((~viofisinf), encuesta), margin=1)
tempo <- encuesta%>%
group_by(viofisinf, year)%>%
summarize(total=survey_total(na.rm=T), vartype = c("ci"), level = 0.95, df = Inf)%>%
ungroup()%>%
group_by(hijos, jefa_o_pareja)%>%
mutate(den=sum(total, na.rm=T),
per=total/den*100)%>%
filter(jefa_o_pareja=="Sí" & vio_fis=="Sí")%>%
mutate(violencia="Violencia física")%>%
ungroup()%>%
select(-jefa_o_pareja, -vio_fis)
svymean(~viofisinf, encuesta)
svyby(~viofisinf >= 0, ~year, encuesta, svytotal)
svymean(~viofisinf, encuesta)
svymean(~viofisinf, ~year, encuesta)
svymean(~viofisinf+year, encuesta)
options(survey.lonely.psu="adjust")
encuesta <- as_survey_design(data, ids=upm_dis, strata=est_dis,
weights = fac_muj, nest=TRUE)
encuesta %>%
group_by(year) %>%
summarize(api_increase = survey_mean(viofisinf, na.rm=T))
encuesta %>%
group_by(as.factor(year)) %>%
summarize(api_increase = survey_mean(viofisinf, na.rm=T))
svymean(~viofisinf, encuesta)
options(survey.lonely.psu="adjust")
encuesta <- as_survey_design(data, ids=upm_dis, strata=est_dis,
weights = fac_muj)
encuesta <- as_survey_design(data, ids=upm_dis, strata=est_dis,
weights = fac_muj, nest=T)
encuesta %>%
group_by(year) %>%
summarize(api_increase = survey_mean(viofisinf))
str(data)
encuesta %>%
group_by(year) %>%
summarize(api_increase = survey_mean(as.factor(viofisinf)))
encuesta %>%
group_by(year, viofisinf) %>%
summarize(api_increase = survey_mean(na.rm=T))
encuesta %>%
group_by(year, viofisinf) %>%
summarize(per = survey_mean(na.rm=T, vartype = c("ci"), level = 0.95, df = Inf))
encuesta %>%
group_by(year, data[vars[1]]) %>%
summarize(per = survey_mean(na.rm=T, vartype = c("ci"), level = 0.95, df = Inf))
vars <- c("viopsiinf", "viofisinf", "viosexinf")
encuesta %>%
group_by(year, data[vars[1]]) %>%
summarize(per = survey_mean(na.rm=T, vartype = c("ci"), level = 0.95, df = Inf))
minitempo <- encuesta %>%
group_by(year, encuesta[vars[1]]) %>%
summarize(per = survey_mean(na.rm=T, vartype = c("ci"), level = 0.95,
df = Inf))
graph <- data.frame()
tempo <- encuesta %>%
group_by(year, viofisinf) %>%
summarize(per = survey_mean(na.rm=T, vartype = c("ci"),
level = 0.95, df = Inf))
View(tempo)
View(tempo)
View(tempo)
tempo <- encuesta %>%
group_by(year, viofisinf) %>%
summarize(per = survey_mean(na.rm=T, vartype = c("ci"),
level = 0.95, df = Inf))%>%
filter(viofisinf=="Sí")%>%
select(-viofisinf)%>%
mutate(var=viofisinf)
View(tempo)
tempo <- encuesta %>%
group_by(year, viofisinf) %>%
summarize(per = survey_mean(na.rm=T, vartype = c("ci"),
level = 0.95, df = Inf))%>%
filter(viofisinf=="Sí")%>%
select(-viofisinf)%>%
mutate(var="viofisinf")
View(tempo)
graph <- bind_rows(graph, tempo)
tempo <- encuesta %>%
group_by(year, viopsiinf) %>%
summarize(per = survey_mean(na.rm=T, vartype = c("ci"),
level = 0.95, df = Inf))%>%
filter(viopsiinf=="Sí")%>%
select(-viopsiinf)%>%
mutate(var="viopsiinf")
View(graph)
tempo <- encuesta %>%
group_by(year, viopsiinf) %>%
summarize(per = survey_mean(na.rm=T, vartype = c("ci"),
level = 0.95, df = Inf))%>%
filter(viopsiinf=="Sí")%>%
select(-viopsiinf)%>%
mutate(var="viopsiinf")
graph <- bind_rows(graph, tempo)
tempo <- encuesta %>%
group_by(year, viopsiinf) %>%
summarize(per = survey_mean(na.rm=T, vartype = c("ci"),
level = 0.95, df = Inf))%>%
filter(viosexinf=="Sí")%>%
select(-viosexinf)%>%
mutate(var="viosexinf")
graph <- bind_rows(graph, tempo)
View(graph)
names(data)
endireh16 <- readRDS(files$endireh16)
endireh21 <- readRDS(files$endireh21)%>%
filter(veinteomas==1)
data <- bind_rows(endireh16, endireh21)%>%
mutate(viosexinf=rowSums(.[,41:46], na.rm=T),
viosexinf=sino(suma(viosexinf)))
View(graph)
graph <- data.frame()
tempo <- encuesta %>%
group_by(year, viofisinf) %>%
summarize(per = survey_mean(na.rm=T, vartype = c("ci"),
level = 0.95, df = Inf))%>%
filter(viofisinf=="Sí")%>%
select(-viofisinf)%>%
mutate(var="viofisinf")
graph <- bind_rows(graph, tempo)
tempo <- encuesta %>%
group_by(year, viopsiinf) %>%
summarize(per = survey_mean(na.rm=T, vartype = c("ci"),
level = 0.95, df = Inf))%>%
filter(viopsiinf=="Sí")%>%
select(-viopsiinf)%>%
mutate(var="viopsiinf")
graph <- bind_rows(graph, tempo)
tempo <- encuesta %>%
group_by(year, viosexinf) %>%
summarize(per = survey_mean(na.rm=T, vartype = c("ci"),
level = 0.95, df = Inf))%>%
filter(viosexinf=="Sí")%>%
select(-viosexinf)%>%
mutate(var="viosexinf")
graph <- bind_rows(graph, tempo)
